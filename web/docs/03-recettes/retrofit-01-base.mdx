---
hide_table_of_contents: true
---

# Retrofit - Appels HTTP de base

ATTENTION : L'outil principal de débogage pour les appels réseaux est le network inspector dans Android Studio.
1. Cliquer sur Fichier / File ou le symbole  ☰ en haut à gauche
2. Choisir View / Tool Windows / AppInspection
3. Dans la fenêtre AppInspection, choisir l'onglet **Network Inspector**
4. Tu devrais voir apparaître les appels réseaux de ton application

[Retrofit](https://square.github.io/retrofit/) est une librairie qui permet de faire des appels HTTP de manière simple et efficace.

Elle est recommandée par la doc standard d'Android pour faire des appels réseaux [source](https://developer.android.com/codelabs/basic-android-kotlin-compose-getting-data-internet?hl=fr#0).

Le code de cette recette est disponible [ici](https://github.com/departement-info-cem/4N6-Applis-Mobile/tree/main/code/RecetteRetrofitSimple).

<Tabs queryString="recette-string">
  <TabItem value="AndroidManifest.xml" label="AndroidManifest.xml">

    Le premier élément est d'accorder à notre application la permission d'utiliser internet.

    Cela se fait en ajoutant la balise suivante entre les balises `<manifest>` et `<application>` dans le fichier `AndroidManifest.xml`.

    ```xml
    <manifest ...
       <uses-permission android:name="android.permission.INTERNET"/>
       <application ...
    ```
  </TabItem>
  <TabItem value="build.gradle.kts" label="build.gradle.kts">

    Il va falloir ajouter les dépendances permettant d'utiliser Retrofit dans le  `build.gradle.kts`.

    ```kts
        implementation 'com.squareup.retrofit2:retrofit:2.9.0'
        implementation group: 'com.squareup.retrofit2', name: 'converter-gson', version: '2.9.0'
        implementation group: 'com.squareup.retrofit2', name: 'converter-scalars', version: '2.9.0'
    ```

  </TabItem>
  <TabItem value="WebService.kt" label="WebService.kt">
    L'interface graphique de chaque item à afficher dans la liste est définie dans un fichier `xml`, comme c'est le cas pour les fichiers `xml` qui sont utilisés pour définir l'interface graphique.

    <GHCode
      repo="4N6-Mobile"
      filePath="code/RecetteRecyclerViewString/app/src/main/res/layout/mon_item.xml"
     />

  </TabItem>
  <TabItem value="UtilitaireRetrofit.kt" label="UtilitaireRetrofit.kt">

    La prochaine étape est de construire un objet pour envoyer les requêtes concrètes de Retrofit:

    ```kotlin
    TODO ici on GHCode

    ```


    <GHCode
      repo="3N5-Prog3"
      filePath="code/RecetteRecyclerViewString/app/src/main/java/org/depinfo/recetterecyclerview/adapter/MonAdapter.kt"
      ignore="10:17-10:90,19-28"
      startLine="10"
      endLine="29"
     />

    <details>
      <summary>Résultat</summary>

      Votre fichier MonAdapter.kt devrait maintenant ressembler à ceci :

      <GHCode
        repo="3N5-Prog3"
        startLine="10"
        filePath="code/RecetteRecyclerViewString/app/src/main/java/org/depinfo/recetterecyclerview/adapter/MonAdapter.kt"
      />
    </details>

  </TabItem>
  <TabItem value="ActivityMain.kt" label="ActivityMain.kt">

    Une fois qu'on a tout ça on peut appeler notre service web dans notre activité principale.

    Ici on montre un appel depuis l'activité principale de la démo mais la technique est la même depuis
    un autre objet (Adapter etc.)

    ```kotlin

    ```
    <GHCode
      repo="3N5-Prog3"
      filePath="code/RecetteRecyclerViewString/app/src/main/res/layout/activity_main.xml"
    />

  </TabItem>
</Tabs>
